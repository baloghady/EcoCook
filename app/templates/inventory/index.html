{% extends 'base.html' %}
{% block title %}Inventory - EcoCook{% endblock %}
{% block content %}

<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-semibold text-gray-800">My Inventory</h1>
  <a href="{{ url_for('inventory.add') }}" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">+ Add Item</a>
  
</div>

<form method="get" class="mb-6">
  <div class="flex gap-2 items-center">
    <input type="text" name="q" value="{{ q or '' }}" placeholder="Search by ingredient name..." class="w-full md:w-1/2 px-3 py-2 border rounded-md" />
    <button type="submit" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">Search</button>
  </div>
  {% if q %}
    <p class="text-sm text-gray-500 mt-1">Filtering by: <span class="font-medium">{{ q }}</span> <a href="{{ url_for('inventory.index') }}" class="text-green-700 underline ml-2">Clear</a></p>
  {% endif %}
</form>

{% if expiring and expiring|length > 0 %}
  <div class="mb-8">
    <h2 class="text-xl font-semibold text-red-700 mb-3">Expiring Soon</h2>
    <div class="overflow-x-auto bg-white border rounded-md">
      <table class="min-w-full">
        <thead class="bg-red-50">
          <tr>
            <th class="text-left px-4 py-2">Ingredient</th>
            <th class="text-left px-4 py-2">Quantity</th>
            <th class="text-left px-4 py-2">Expiry</th>
          </tr>
        </thead>
        <tbody>
          {% for item in expiring %}
            <tr class="border-t">
              <td class="px-4 py-2 font-medium">{{ item.ingredient.name|title }}</td>
              <td class="px-4 py-2">{{ '%.2f'|format(item.quantity) }} {{ item.unit or item.ingredient.unit }}</td>
              <td class="px-4 py-2">
                {% if item.expiry_date %}
                  <span class="inline-block px-2 py-1 text-sm rounded {{ 'bg-red-100 text-red-800' if item.days_to_expiry is not none and item.days_to_expiry <= 2 else 'bg-yellow-100 text-yellow-800' }}">
                    {{ item.expiry_date }} {% if item.days_to_expiry is not none %} (in {{ item.days_to_expiry }} days){% endif %}
                  </span>
                {% else %}
                  â€”
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endif %}

<div>
  <h2 class="text-xl font-semibold text-gray-800 mb-3">All Items</h2>
  <div class="overflow-x-auto bg-white border rounded-md">
    <table class="min-w-full">
      <thead class="bg-gray-50">
        <tr>
          <th class="text-left px-4 py-2">Ingredient</th>
          <th class="text-left px-4 py-2">Quantity</th>
          <th class="text-left px-4 py-2">Expiry</th>
          <th class="text-left px-4 py-2">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr class="border-t">
            <td class="px-4 py-2 font-medium">{{ item.ingredient.name|title }}</td>
            <td class="px-4 py-2">{{ '%.2f'|format(item.quantity) }} {{ item.unit or item.ingredient.unit }}</td>
            <td class="px-4 py-2">
              {% if item.expiry_date %}
                <span class="inline-block px-2 py-1 text-sm rounded {{ 'bg-red-100 text-red-800' if item.days_to_expiry is not none and item.days_to_expiry <= 2 else 'bg-yellow-100 text-yellow-800' }}">
                  {{ item.expiry_date }} {% if item.days_to_expiry is not none %} (in {{ item.days_to_expiry }} days){% endif %}
                </span>
              {% else %}
                <span class="text-gray-400">No expiry</span>
              {% endif %}
            </td>
            <td class="px-4 py-2">
              <form action="{{ url_for('inventory.delete', item_id=item.id) }}" method="post" onsubmit="return confirm('Delete this item?');">
                <button type="submit" class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700">Delete</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr>
            <td class="px-4 py-3 text-gray-500" colspan="4">No items yet. Click "Add Item" to get started.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
